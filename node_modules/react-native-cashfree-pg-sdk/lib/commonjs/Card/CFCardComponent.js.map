{"version":3,"names":["_reactNative","require","_react","_interopRequireWildcard","_cashfreePgApiContract","_index","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","luhnCheck","cardNumber","length","replace","sum","isAlternate","digit","parseInt","getTDR","session","bin","route","payment_session_id","body","JSON","stringify","getInfo","environment","getCardBin","env","bodyData","baseUrl","CFEnvironment","SANDBOX","url","response","fetch","method","headers","ok","json","error","CardInput","forwardRef","cfSession","cardListener","style","props","ref","inputNumber","setInputNumber","React","useState","useImperativeHandle","doPayment","tdrJson","cardBinJson","firstEightDigits","handleChange","useCallback","completeResponse","textWithoutSpaces","replaceAll","formattedText","end","substring","tdrResponse","cardBinResponse","fetchDataAndSet","then","catch","cardInfo","cardPayment","CFCardPayment","CFPaymentGatewayService","makePayment","console","log","message","handleSubmitEditingEvent","event","newEvent","nativeEvent","text","onSubmitEditing","handleEndEditingEvent","onEndEditing","handleFocusEvent","onFocus","handleBlurEvent","onBlur","InputComponent","TextInput","onChangeText","onChange","otherProps","createElement","keyboardType","inputMode","value","_default","exports"],"sources":["CFCardComponent.js"],"sourcesContent":["import { TextInput } from 'react-native';\nimport React, { forwardRef } from 'react';\nimport { CFCardPayment, CFEnvironment } from 'cashfree-pg-api-contract';\nimport { CFPaymentGatewayService } from '../index';\nfunction luhnCheck(cardNumber) {\n    if (cardNumber.length === 0) {\n        return false;\n    }\n    cardNumber = cardNumber.replace(/\\s/g, ''); // Remove spaces\n    let sum = 0;\n    let isAlternate = false;\n    for (let i = cardNumber.length - 1; i >= 0; i--) {\n        let digit = parseInt(cardNumber[i], 10);\n        if (isAlternate) {\n            digit *= 2;\n            if (digit > 9) {\n                digit -= 9;\n            }\n        }\n        sum += digit;\n        isAlternate = !isAlternate;\n    }\n    return sum % 10 === 0;\n}\n/**\n * Fetching Tdr info with card bin data & cfSession object\n * @param session :  for payment sessionId & env\n * @param bin : for card number\n */\nasync function getTDR(session, bin) {\n    const route = `/pg/sdk/js/${session.payment_session_id}/v2/tdr`;\n    const body = JSON.stringify({ 'code': bin, 'code_type': 'bin' });\n    return await getInfo(session.environment, route, body);\n}\n/**\n * Fetching CardBin info with card bin data & cfSession object\n * @param session :  for payment sessionId & env\n * @param bin : for card number\n */\nasync function getCardBin(session, bin) {\n    const route = `/pg/sdk/js/${session.payment_session_id}/cardBin`;\n    const body = JSON.stringify({ 'card_number': bin });\n    return await getInfo(session.environment, route, body);\n}\nasync function getInfo(env, route, bodyData) {\n    let baseUrl = 'https://api.cashfree.com';\n    if (env === CFEnvironment.SANDBOX) {\n        baseUrl = 'https://sandbox.cashfree.com';\n    }\n    const url = baseUrl + route;\n    try {\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: bodyData,\n        });\n        if (!response.ok) {\n            return null;\n        }\n        return await response.json();\n    }\n    catch (error) {\n        return null;\n    }\n}\nconst CardInput = forwardRef(({ cfSession, cardListener, style, ...props }, ref) => {\n    const [inputNumber, setInputNumber] = React.useState('');\n    React.useImperativeHandle(ref, () => ({ doPayment }));\n    let tdrJson = null;\n    let cardBinJson = null;\n    let firstEightDigits = '';\n    const handleChange = React.useCallback(async (cardNumber) => {\n        let completeResponse = {};\n        const textWithoutSpaces = cardNumber.replaceAll(' ', '');\n        if (textWithoutSpaces.length === 0)\n            setInputNumber('');\n        let formattedText = '';\n        /**\n         * Code to format card input number & set to input box\n         */\n        for (let i = 0; i < textWithoutSpaces.length; i += 4) {\n            let end = i + 4;\n            if (end > textWithoutSpaces.length) {\n                end = textWithoutSpaces.length;\n            }\n            formattedText += textWithoutSpaces.substring(i, end);\n            if (end !== textWithoutSpaces.length) {\n                formattedText += ' ';\n            }\n            setInputNumber(formattedText);\n        }\n        let tdrResponse = null;\n        let cardBinResponse = null;\n        /**\n         * Fetch Tdr & CardBin data & set to local variable\n         */\n        async function fetchDataAndSet() {\n            await getTDR(cfSession, textWithoutSpaces)\n                .then((response) => {\n                tdrResponse = response;\n            })\n                .catch(() => {\n                tdrResponse = null;\n            });\n            await getCardBin(cfSession, textWithoutSpaces)\n                .then((response) => {\n                cardBinResponse = response;\n            })\n                .catch(() => {\n                cardBinResponse = null;\n            });\n            if (tdrResponse) {\n                tdrJson = tdrResponse;\n                completeResponse['tdr_info'] = tdrJson;\n            }\n            if (cardBinResponse) {\n                cardBinJson = cardBinResponse;\n                completeResponse['card_bin_info'] = cardBinJson;\n            }\n        }\n        if (textWithoutSpaces.length === 8) {\n            firstEightDigits = textWithoutSpaces;\n            await fetchDataAndSet();\n        }\n        else if (textWithoutSpaces.length > 8) {\n            if (firstEightDigits === textWithoutSpaces.substring(0, 8)) {\n                completeResponse['tdr_info'] = tdrJson;\n                completeResponse['card_bin_info'] = cardBinJson;\n            }\n            else {\n                firstEightDigits = textWithoutSpaces.substring(0, 8);\n                tdrJson = null;\n                cardBinJson = null;\n                await fetchDataAndSet();\n            }\n        }\n        if (textWithoutSpaces.length < 8) {\n            cardBinJson = null;\n            tdrJson = null;\n            firstEightDigits = '';\n        }\n        if (cardBinJson !== null) {\n            completeResponse['card_network'] = cardBinJson['scheme'];\n        }\n        completeResponse['luhn_check_info'] = 'SUCCESS';\n        if (!luhnCheck(textWithoutSpaces)) {\n            completeResponse['luhn_check_info'] = 'FAIL';\n        }\n        completeResponse['card_length'] = textWithoutSpaces.length;\n        return cardListener(JSON.stringify(completeResponse));\n    }, [cardListener]);\n    const doPayment = (cardInfo) => {\n        try {\n            cardInfo.cardNumber = inputNumber.replaceAll(' ', '');\n            const cardPayment = new CFCardPayment(cfSession, cardInfo);\n            CFPaymentGatewayService.makePayment(cardPayment);\n        }\n        catch (e) {\n            console.log(e.message);\n        }\n    };\n    const handleSubmitEditingEvent = (event) => {\n        const newEvent = { ...event };\n        delete newEvent.nativeEvent.text;\n        if (onSubmitEditing) {\n            onSubmitEditing(newEvent);\n        }\n    };\n    const handleEndEditingEvent = (event) => {\n        const newEvent = { ...event };\n        delete newEvent.nativeEvent.text;\n        if (onEndEditing) {\n            onEndEditing(newEvent);\n        }\n    };\n    const handleFocusEvent = (event) => {\n        const newEvent = { ...event };\n        delete newEvent.nativeEvent.text;\n        if (onFocus) {\n            onFocus(newEvent);\n        }\n    };\n    const handleBlurEvent = (event) => {\n        const newEvent = { ...event };\n        delete newEvent.nativeEvent.text;\n        if (onBlur) {\n            onBlur(newEvent);\n        }\n    };\n    const InputComponent = TextInput;\n    const { onChangeText, onChange, onSubmitEditing, onEndEditing, onFocus, onBlur, ...otherProps } = props;\n    return (React.createElement(InputComponent, { keyboardType: 'numeric', inputMode: 'numeric', value: inputNumber, onChangeText: handleChange, onSubmitEditing: handleSubmitEditingEvent, onEndEditing: handleEndEditingEvent, onFocus: handleFocusEvent, onBlur: handleBlurEvent, style: style, ...otherProps }));\n});\nexport default CardInput;\n"],"mappings":";;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,sBAAA,GAAAH,OAAA;AACA,IAAAI,MAAA,GAAAJ,OAAA;AAAmD,SAAAK,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAJ,wBAAAI,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AACnD,SAASW,SAASA,CAACC,UAAU,EAAE;EAC3B,IAAIA,UAAU,CAACC,MAAM,KAAK,CAAC,EAAE;IACzB,OAAO,KAAK;EAChB;EACAD,UAAU,GAAGA,UAAU,CAACE,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC;EAC5C,IAAIC,GAAG,GAAG,CAAC;EACX,IAAIC,WAAW,GAAG,KAAK;EACvB,KAAK,IAAIP,CAAC,GAAGG,UAAU,CAACC,MAAM,GAAG,CAAC,EAAEJ,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;IAC7C,IAAIQ,KAAK,GAAGC,QAAQ,CAACN,UAAU,CAACH,CAAC,CAAC,EAAE,EAAE,CAAC;IACvC,IAAIO,WAAW,EAAE;MACbC,KAAK,IAAI,CAAC;MACV,IAAIA,KAAK,GAAG,CAAC,EAAE;QACXA,KAAK,IAAI,CAAC;MACd;IACJ;IACAF,GAAG,IAAIE,KAAK;IACZD,WAAW,GAAG,CAACA,WAAW;EAC9B;EACA,OAAOD,GAAG,GAAG,EAAE,KAAK,CAAC;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,eAAeI,MAAMA,CAACC,OAAO,EAAEC,GAAG,EAAE;EAChC,MAAMC,KAAK,GAAI,cAAaF,OAAO,CAACG,kBAAmB,SAAQ;EAC/D,MAAMC,IAAI,GAAGC,IAAI,CAACC,SAAS,CAAC;IAAE,MAAM,EAAEL,GAAG;IAAE,WAAW,EAAE;EAAM,CAAC,CAAC;EAChE,OAAO,MAAMM,OAAO,CAACP,OAAO,CAACQ,WAAW,EAAEN,KAAK,EAAEE,IAAI,CAAC;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,eAAeK,UAAUA,CAACT,OAAO,EAAEC,GAAG,EAAE;EACpC,MAAMC,KAAK,GAAI,cAAaF,OAAO,CAACG,kBAAmB,UAAS;EAChE,MAAMC,IAAI,GAAGC,IAAI,CAACC,SAAS,CAAC;IAAE,aAAa,EAAEL;EAAI,CAAC,CAAC;EACnD,OAAO,MAAMM,OAAO,CAACP,OAAO,CAACQ,WAAW,EAAEN,KAAK,EAAEE,IAAI,CAAC;AAC1D;AACA,eAAeG,OAAOA,CAACG,GAAG,EAAER,KAAK,EAAES,QAAQ,EAAE;EACzC,IAAIC,OAAO,GAAG,0BAA0B;EACxC,IAAIF,GAAG,KAAKG,oCAAa,CAACC,OAAO,EAAE;IAC/BF,OAAO,GAAG,8BAA8B;EAC5C;EACA,MAAMG,GAAG,GAAGH,OAAO,GAAGV,KAAK;EAC3B,IAAI;IACA,MAAMc,QAAQ,GAAG,MAAMC,KAAK,CAACF,GAAG,EAAE;MAC9BG,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACL,cAAc,EAAE;MACpB,CAAC;MACDf,IAAI,EAAEO;IACV,CAAC,CAAC;IACF,IAAI,CAACK,QAAQ,CAACI,EAAE,EAAE;MACd,OAAO,IAAI;IACf;IACA,OAAO,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;EAChC,CAAC,CACD,OAAOC,KAAK,EAAE;IACV,OAAO,IAAI;EACf;AACJ;AACA,MAAMC,SAAS,gBAAG,IAAAC,iBAAU,EAAC,CAAC;EAAEC,SAAS;EAAEC,YAAY;EAAEC,KAAK;EAAE,GAAGC;AAAM,CAAC,EAAEC,GAAG,KAAK;EAChF,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGC,cAAK,CAACC,QAAQ,CAAC,EAAE,CAAC;EACxDD,cAAK,CAACE,mBAAmB,CAACL,GAAG,EAAE,OAAO;IAAEM;EAAU,CAAC,CAAC,CAAC;EACrD,IAAIC,OAAO,GAAG,IAAI;EAClB,IAAIC,WAAW,GAAG,IAAI;EACtB,IAAIC,gBAAgB,GAAG,EAAE;EACzB,MAAMC,YAAY,GAAGP,cAAK,CAACQ,WAAW,CAAC,MAAOhD,UAAU,IAAK;IACzD,IAAIiD,gBAAgB,GAAG,CAAC,CAAC;IACzB,MAAMC,iBAAiB,GAAGlD,UAAU,CAACmD,UAAU,CAAC,GAAG,EAAE,EAAE,CAAC;IACxD,IAAID,iBAAiB,CAACjD,MAAM,KAAK,CAAC,EAC9BsC,cAAc,CAAC,EAAE,CAAC;IACtB,IAAIa,aAAa,GAAG,EAAE;IACtB;AACR;AACA;IACQ,KAAK,IAAIvD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGqD,iBAAiB,CAACjD,MAAM,EAAEJ,CAAC,IAAI,CAAC,EAAE;MAClD,IAAIwD,GAAG,GAAGxD,CAAC,GAAG,CAAC;MACf,IAAIwD,GAAG,GAAGH,iBAAiB,CAACjD,MAAM,EAAE;QAChCoD,GAAG,GAAGH,iBAAiB,CAACjD,MAAM;MAClC;MACAmD,aAAa,IAAIF,iBAAiB,CAACI,SAAS,CAACzD,CAAC,EAAEwD,GAAG,CAAC;MACpD,IAAIA,GAAG,KAAKH,iBAAiB,CAACjD,MAAM,EAAE;QAClCmD,aAAa,IAAI,GAAG;MACxB;MACAb,cAAc,CAACa,aAAa,CAAC;IACjC;IACA,IAAIG,WAAW,GAAG,IAAI;IACtB,IAAIC,eAAe,GAAG,IAAI;IAC1B;AACR;AACA;IACQ,eAAeC,eAAeA,CAAA,EAAG;MAC7B,MAAMlD,MAAM,CAAC0B,SAAS,EAAEiB,iBAAiB,CAAC,CACrCQ,IAAI,CAAElC,QAAQ,IAAK;QACpB+B,WAAW,GAAG/B,QAAQ;MAC1B,CAAC,CAAC,CACGmC,KAAK,CAAC,MAAM;QACbJ,WAAW,GAAG,IAAI;MACtB,CAAC,CAAC;MACF,MAAMtC,UAAU,CAACgB,SAAS,EAAEiB,iBAAiB,CAAC,CACzCQ,IAAI,CAAElC,QAAQ,IAAK;QACpBgC,eAAe,GAAGhC,QAAQ;MAC9B,CAAC,CAAC,CACGmC,KAAK,CAAC,MAAM;QACbH,eAAe,GAAG,IAAI;MAC1B,CAAC,CAAC;MACF,IAAID,WAAW,EAAE;QACbX,OAAO,GAAGW,WAAW;QACrBN,gBAAgB,CAAC,UAAU,CAAC,GAAGL,OAAO;MAC1C;MACA,IAAIY,eAAe,EAAE;QACjBX,WAAW,GAAGW,eAAe;QAC7BP,gBAAgB,CAAC,eAAe,CAAC,GAAGJ,WAAW;MACnD;IACJ;IACA,IAAIK,iBAAiB,CAACjD,MAAM,KAAK,CAAC,EAAE;MAChC6C,gBAAgB,GAAGI,iBAAiB;MACpC,MAAMO,eAAe,CAAC,CAAC;IAC3B,CAAC,MACI,IAAIP,iBAAiB,CAACjD,MAAM,GAAG,CAAC,EAAE;MACnC,IAAI6C,gBAAgB,KAAKI,iBAAiB,CAACI,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;QACxDL,gBAAgB,CAAC,UAAU,CAAC,GAAGL,OAAO;QACtCK,gBAAgB,CAAC,eAAe,CAAC,GAAGJ,WAAW;MACnD,CAAC,MACI;QACDC,gBAAgB,GAAGI,iBAAiB,CAACI,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;QACpDV,OAAO,GAAG,IAAI;QACdC,WAAW,GAAG,IAAI;QAClB,MAAMY,eAAe,CAAC,CAAC;MAC3B;IACJ;IACA,IAAIP,iBAAiB,CAACjD,MAAM,GAAG,CAAC,EAAE;MAC9B4C,WAAW,GAAG,IAAI;MAClBD,OAAO,GAAG,IAAI;MACdE,gBAAgB,GAAG,EAAE;IACzB;IACA,IAAID,WAAW,KAAK,IAAI,EAAE;MACtBI,gBAAgB,CAAC,cAAc,CAAC,GAAGJ,WAAW,CAAC,QAAQ,CAAC;IAC5D;IACAI,gBAAgB,CAAC,iBAAiB,CAAC,GAAG,SAAS;IAC/C,IAAI,CAAClD,SAAS,CAACmD,iBAAiB,CAAC,EAAE;MAC/BD,gBAAgB,CAAC,iBAAiB,CAAC,GAAG,MAAM;IAChD;IACAA,gBAAgB,CAAC,aAAa,CAAC,GAAGC,iBAAiB,CAACjD,MAAM;IAC1D,OAAOiC,YAAY,CAACrB,IAAI,CAACC,SAAS,CAACmC,gBAAgB,CAAC,CAAC;EACzD,CAAC,EAAE,CAACf,YAAY,CAAC,CAAC;EAClB,MAAMS,SAAS,GAAIiB,QAAQ,IAAK;IAC5B,IAAI;MACAA,QAAQ,CAAC5D,UAAU,GAAGsC,WAAW,CAACa,UAAU,CAAC,GAAG,EAAE,EAAE,CAAC;MACrD,MAAMU,WAAW,GAAG,IAAIC,oCAAa,CAAC7B,SAAS,EAAE2B,QAAQ,CAAC;MAC1DG,8BAAuB,CAACC,WAAW,CAACH,WAAW,CAAC;IACpD,CAAC,CACD,OAAOjF,CAAC,EAAE;MACNqF,OAAO,CAACC,GAAG,CAACtF,CAAC,CAACuF,OAAO,CAAC;IAC1B;EACJ,CAAC;EACD,MAAMC,wBAAwB,GAAIC,KAAK,IAAK;IACxC,MAAMC,QAAQ,GAAG;MAAE,GAAGD;IAAM,CAAC;IAC7B,OAAOC,QAAQ,CAACC,WAAW,CAACC,IAAI;IAChC,IAAIC,eAAe,EAAE;MACjBA,eAAe,CAACH,QAAQ,CAAC;IAC7B;EACJ,CAAC;EACD,MAAMI,qBAAqB,GAAIL,KAAK,IAAK;IACrC,MAAMC,QAAQ,GAAG;MAAE,GAAGD;IAAM,CAAC;IAC7B,OAAOC,QAAQ,CAACC,WAAW,CAACC,IAAI;IAChC,IAAIG,YAAY,EAAE;MACdA,YAAY,CAACL,QAAQ,CAAC;IAC1B;EACJ,CAAC;EACD,MAAMM,gBAAgB,GAAIP,KAAK,IAAK;IAChC,MAAMC,QAAQ,GAAG;MAAE,GAAGD;IAAM,CAAC;IAC7B,OAAOC,QAAQ,CAACC,WAAW,CAACC,IAAI;IAChC,IAAIK,OAAO,EAAE;MACTA,OAAO,CAACP,QAAQ,CAAC;IACrB;EACJ,CAAC;EACD,MAAMQ,eAAe,GAAIT,KAAK,IAAK;IAC/B,MAAMC,QAAQ,GAAG;MAAE,GAAGD;IAAM,CAAC;IAC7B,OAAOC,QAAQ,CAACC,WAAW,CAACC,IAAI;IAChC,IAAIO,MAAM,EAAE;MACRA,MAAM,CAACT,QAAQ,CAAC;IACpB;EACJ,CAAC;EACD,MAAMU,cAAc,GAAGC,sBAAS;EAChC,MAAM;IAAEC,YAAY;IAAEC,QAAQ;IAAEV,eAAe;IAAEE,YAAY;IAAEE,OAAO;IAAEE,MAAM;IAAE,GAAGK;EAAW,CAAC,GAAGhD,KAAK;EACvG,oBAAQI,cAAK,CAAC6C,aAAa,CAACL,cAAc,EAAE;IAAEM,YAAY,EAAE,SAAS;IAAEC,SAAS,EAAE,SAAS;IAAEC,KAAK,EAAElD,WAAW;IAAE4C,YAAY,EAAEnC,YAAY;IAAE0B,eAAe,EAAEL,wBAAwB;IAAEO,YAAY,EAAED,qBAAqB;IAAEG,OAAO,EAAED,gBAAgB;IAAEG,MAAM,EAAED,eAAe;IAAE3C,KAAK,EAAEA,KAAK;IAAE,GAAGiD;EAAW,CAAC,CAAC;AACnT,CAAC,CAAC;AAAC,IAAAK,QAAA,GAAAC,OAAA,CAAAzG,OAAA,GACY8C,SAAS","ignoreList":[]}